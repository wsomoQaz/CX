local MyUILib = {}
local UserInputService = game:GetService("UserInputService")

function MyUILib:CreateWindow(config)
	local player = game.Players.LocalPlayer
	local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
	gui.Name = config.Name or "MyUILib"
	gui.ResetOnSpawn = false
	gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

	local mainFrame = Instance.new("Frame", gui)
	mainFrame.Size = UDim2.new(0, 400, 0, 460)
	mainFrame.Position = UDim2.new(0.5, -200, 0.5, -230)
	mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	mainFrame.BackgroundTransparency = 0.5
	mainFrame.BorderSizePixel = 0

	local title = Instance.new("TextLabel", mainFrame)
	title.Size = UDim2.new(1, 0, 0, 30)
	title.Text = config.Title or "MyUILib GUI"
	title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	title.BackgroundTransparency = 0.5
	title.TextColor3 = Color3.new(1, 1, 1)
	title.TextSize = 16
	title.Font = Enum.Font.SourceSansBold

	-- 拖动
	local dragging, dragInput, dragStart, startPos
	title.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = mainFrame.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)
	title.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - dragStart
			mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X,
										   startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)

	-- 左侧标签区域
	local tabBar = Instance.new("Frame", mainFrame)
	tabBar.Size = UDim2.new(0, 90, 1, -30)
	tabBar.Position = UDim2.new(0, 0, 0, 30)
	tabBar.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	tabBar.BackgroundTransparency = 0.5

	local tabLayout = Instance.new("UIListLayout", tabBar)
	tabLayout.SortOrder = Enum.SortOrder.LayoutOrder
	tabLayout.Padding = UDim.new(0, 4)

	local tabButtons = {}
	local tabFrames = {}
	local currentTab = nil

	-- 创建 Tab 函数
	local function CreateTab(name)
		local tabBtn = Instance.new("TextButton", tabBar)
		tabBtn.Size = UDim2.new(1, 0, 0, 32)
		tabBtn.Text = name
		tabBtn.BackgroundTransparency = 0.5
		tabBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
		tabBtn.TextColor3 = Color3.new(1, 1, 1)
		tabBtn.Font = Enum.Font.SourceSans
		tabBtn.TextSize = 14

		local content = Instance.new("Frame", mainFrame)
		content.Size = UDim2.new(1, -100, 1, -40)
		content.Position = UDim2.new(0, 100, 0, 40)
		content.BackgroundTransparency = 1
		content.Visible = false

		local layout = Instance.new("UIListLayout", content)
		layout.Padding = UDim.new(0, 6)
		layout.SortOrder = Enum.SortOrder.LayoutOrder

		tabBtn.MouseButton1Click:Connect(function()
			for _, f in pairs(tabFrames) do f.Visible = false end
			content.Visible = true
			currentTab = content
		end)

		table.insert(tabButtons, tabBtn)
		table.insert(tabFrames, content)

		if not currentTab then
			content.Visible = true
			currentTab = content
		end

		return content
	end

	local window = {}
	window.Main = mainFrame
	window.CreateTab = CreateTab
	return window
end

function MyUILib:AddLabel(tab, text)
	local label = Instance.new("TextLabel", tab)
	label.Size = UDim2.new(1, -20, 0, 24)
	label.Position = UDim2.new(0, 10, 0, 0)
	label.BackgroundTransparency = 1
	label.Text = text or "标签"
	label.TextColor3 = Color3.new(1, 1, 1)
	label.TextSize = 14
	label.Font = Enum.Font.SourceSans
end

function MyUILib:AddButton(tab, text, callback)
	local btn = Instance.new("TextButton", tab)
	btn.Size = UDim2.new(1, -20, 0, 32)
	btn.Position = UDim2.new(0, 10, 0, 0)
	btn.Text = text or "按钮"
	btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	btn.BackgroundTransparency = 0.5
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.SourceSans
	btn.TextSize = 14
	btn.MouseButton1Click:Connect(function() if callback then callback() end end)
end

function MyUILib:AddToggle(tab, text, default, callback)
	local toggle = Instance.new("TextButton", tab)
	toggle.Size = UDim2.new(1, -20, 0, 32)
	toggle.Text = text .. ": " .. (default and "开" or "关")
	toggle.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
	toggle.BackgroundTransparency = 0.5
	toggle.TextColor3 = Color3.new(1, 1, 1)
	toggle.Font = Enum.Font.SourceSans
	toggle.TextSize = 14

	local state = default
	toggle.MouseButton1Click:Connect(function()
		state = not state
		toggle.Text = text .. ": " .. (state and "开" or "关")
		if callback then callback(state) end
	end)
end

function MyUILib:AddSlider(tab, text, min, max, default, callback)
	local frame = Instance.new("Frame", tab)
	frame.Size = UDim2.new(1, -20, 0, 40)
	frame.BackgroundTransparency = 1

	local label = Instance.new("TextLabel", frame)
	label.Size = UDim2.new(1, 0, 0, 20)
	label.Text = text .. ": " .. tostring(default)
	label.TextColor3 = Color3.new(1, 1, 1)
	label.BackgroundTransparency = 1
	label.Font = Enum.Font.SourceSans
	label.TextSize = 14

	local slider = Instance.new("TextButton", frame)
	slider.Size = UDim2.new(1, 0, 0, 18)
	slider.Position = UDim2.new(0, 0, 0, 20)
	slider.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
	slider.BackgroundTransparency = 0.5
	slider.Text = ""

	local value = default
	slider.MouseButton1Down:Connect(function()
		local conn
		conn = UserInputService.InputChanged:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseMovement then
				local x = input.Position.X - slider.AbsolutePosition.X
				local percent = math.clamp(x / slider.AbsoluteSize.X, 0, 1)
				value = math.floor(min + (max - min) * percent + 0.5)
				label.Text = text .. ": " .. tostring(value)
				if callback then callback(value) end
			end
		end)
		UserInputService.InputEnded:Wait()
		conn:Disconnect()
	end)
end

function MyUILib:AddTextbox(tab, placeholder, callback)
	local box = Instance.new("TextBox", tab)
	box.Size = UDim2.new(1, -20, 0, 32)
	box.PlaceholderText = placeholder or "请输入文字"
	box.Text = ""
	box.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
	box.BackgroundTransparency = 0.5
	box.TextColor3 = Color3.new(1, 1, 1)
	box.TextSize = 14
	box.Font = Enum.Font.SourceSans

	box.FocusLost:Connect(function(enter)
		if enter and callback then callback(box.Text) end
	end)
end

function MyUILib:AddDropdown(tab, text, list, callback)
	local dropdown = Instance.new("TextButton", tab)
	dropdown.Size = UDim2.new(1, -20, 0, 32)
	dropdown.Text = text .. ": " .. list[1]
	dropdown.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
	dropdown.BackgroundTransparency = 0.5
	dropdown.TextColor3 = Color3.new(1, 1, 1)
	dropdown.Font = Enum.Font.SourceSans
	dropdown.TextSize = 14

	local index = 1
	dropdown.MouseButton1Click:Connect(function()
		index = (index % #list) + 1
		dropdown.Text = text .. ": " .. list[index]
		if callback then callback(list[index]) end
	end)
end

function MyUILib:AddKeybind(tab, text, defaultKey, callback)
	local btn = Instance.new("TextButton", tab)
	btn.Size = UDim2.new(1, -20, 0, 32)
	btn.Text = text .. ": [" .. defaultKey.Name .. "]"
	btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	btn.BackgroundTransparency = 0.5
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.SourceSans
	btn.TextSize = 14

	local listening = false
	btn.MouseButton1Click:Connect(function()
		btn.Text = text .. ": [按下按键]"
		listening = true
	end)

	UserInputService.InputBegan:Connect(function(input, gameProcessed)
		if not gameProcessed and listening then
			listening = false
			btn.Text = text .. ": [" .. input.KeyCode.Name .. "]"
			if callback then callback(input.KeyCode) end
		end
	end)
end

return MyUILib